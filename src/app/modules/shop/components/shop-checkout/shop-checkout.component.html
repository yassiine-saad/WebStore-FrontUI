<!-- <div class="checkout-container">
    <h2>Checkout</h2>
    <div *ngIf="(cartItems$ | async) as cartItems">
        
        <div *ngIf="cartItems.length === 0">
            <p>Your cart is empty</p>
        </div>

        <div *ngIf="cartItems.length > 0">
            <div class="checkout-item" *ngFor="let item of cartItems">
                <img [src]="item.product.images[0]" alt="{{ item.product.title }}">
                <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8cHJvZHVjdHxlbnwwfHwwfHx8MA%3D%3D" alt="{{ item.product.name }}">
                <div class="item-details">
                <h3>{{ item.product.name }}</h3>
                <p>Quantity: {{ item.quantity }}</p>
                <p>Price: ${{ item.product.price * item.quantity }}</p>
                </div>
            </div>
            <div class="checkout-total">
                <h3>Total: ${{ getTotal(cartItems) }}</h3>
            </div>
        </div>
    </div>

    <div class="checkout-form">

        <form [formGroup]="checkoutForm"  (ngSubmit)="onSubmit()">

            <mat-card>
                <mat-card-header>
                    <mat-card-title>Informations de livraison</mat-card-title>
                </mat-card-header>
        
                <mat-card-content>
                    <mat-form-field>
                        <mat-label>Nom</mat-label>
                        <input matInput formControlName="lastName">
                    </mat-form-field>
                
                    <mat-form-field>
                        <mat-label>Prénom</mat-label>
                        <input matInput formControlName="firstName">
                    </mat-form-field>
                    
                    <mat-form-field>
                        <mat-label>Adresse e-mail</mat-label>
                        <input matInput type="email" formControlName="email">
                    </mat-form-field>
                
                    <mat-form-field>
                        <mat-label>Téléphone</mat-label>
                        <input matInput type="tel"  formControlName="phoneNumber">
                    </mat-form-field>
                
                </mat-card-content>
            </mat-card>


            <mat-card>
                <mat-card-header>
                  <mat-card-title>Mode de paiement</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <mat-radio-group formControlName="paymentMethod">
                        <mat-list>
                        <mat-list-item *ngFor="let method of paymentMethods">
                            <mat-radio-button [value]="method.value">
                            <mat-icon>{{ method.icon }}</mat-icon>
                            <span>{{ method.label }}</span>
                            </mat-radio-button>
                        </mat-list-item>
                        </mat-list>
                    </mat-radio-group>
                </mat-card-content>
        
            
                <div *ngIf="checkoutForm.get('paymentMethod')?.value === 'card'">
                    <mat-form-field>
                        <mat-label>Numéro de carte</mat-label>
                        <input matInput >
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>Nom du titulaire de la carte</mat-label>
                        <input matInput >
                    </mat-form-field>
                </div>
            </mat-card>

            <mat-card>
                <mat-card-header>
                  <mat-card-title>Mode de récupération</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <mat-form-field>
                    <mat-label>Choisir le mode de récupération</mat-label>
                    <mat-select formControlName="pickupMethod">
                      <mat-option value="pickup">Ramassage en magasin</mat-option>
                      <mat-option value="delivery">Livraison à domicile</mat-option>
                    </mat-select>
                  </mat-form-field>
               
                  <div *ngIf="checkoutForm.get('pickupMethod')?.value === 'delivery'">
                    <mat-form-field>
                      <mat-label>Adresse</mat-label>
                      <input matInput formControlName="address">
                    </mat-form-field>
        
                    <mat-form-field>
                      <mat-label>Ville</mat-label>
                      <input matInput formControlName="city">
                    </mat-form-field>
        
                    <mat-form-field>
                      <mat-label>Pays</mat-label>
                      <input matInput value="France" disabled>
                    </mat-form-field>
        
                  </div>
                
                  <div *ngIf="checkoutForm.get('pickupMethod')?.value === 'pickup'">
                    <p class="pickup-address">
                      Vous avez choisi le ramassage en magasin.<br> L'adresse du magasin est : <br><br>
                      tiptech 114 rue paris 93260 les lilas.
                    </p>
                  </div>
                  
                </mat-card-content>
            </mat-card>

            <button class="confirm-btn">Confirm Purchase</button>
        </form>

    </div>

</div>
   -->











   <div class="checkout-container">
    <h2>Checkout</h2>
    <div *ngIf="(cartItems$ | async) as cartItems">
        <div *ngIf="cartItems.length === 0">
            <p>Your cart is empty</p>
        </div>

        <div *ngIf="cartItems.length > 0">
            <div class="checkout-item" *ngFor="let item of cartItems">
                <img  [src]="item.product.images[0].imageUrl" alt="{{ item.product.name }}">
                <div class="item-details">
                    <h3>{{ item.product.name }}</h3>
                    <p>Quantity: {{ item.quantity }}</p>
                    <p>Price: ${{ item.product.price * item.quantity }}</p>
                </div>
            </div>
            <div class="checkout-total">
                <h3>Total: {{ getTotal(cartItems) | currency : 'EUR' }}</h3>
            </div>
        </div>
    </div>

    <div class="checkout-form">
        <form [formGroup]="checkoutForm" >
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Informations de livraison</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <mat-form-field>
                        <mat-label>Nom</mat-label>
                        <input matInput formControlName="lastName">
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>Prénom</mat-label>
                        <input matInput formControlName="firstName">
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>Adresse e-mail</mat-label>
                        <input matInput type="email" formControlName="email">
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>Téléphone</mat-label>
                        <input matInput type="tel" formControlName="phoneNumber">
                    </mat-form-field>
                </mat-card-content>
            </mat-card>

            <mat-card>
                <mat-card-header>
                    <mat-card-title>Mode de paiement</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <mat-radio-group formControlName="paymentMethod">
                        <mat-list>
                            <mat-list-item *ngFor="let method of paymentMethods">
                                <mat-radio-button [value]="method.value">
                                    <mat-icon>{{ method.icon }}</mat-icon>
                                    <span>{{ method.label }}</span>
                                </mat-radio-button>
                            </mat-list-item>
                        </mat-list>
                    </mat-radio-group>
                </mat-card-content>
                <div *ngIf="checkoutForm.get('paymentMethod')?.value === 'card'">

                    <!-- <app-payment  #cardpay [card]="card" [stripe]="stripe" ></app-payment> -->

                    <app-credit-card-form
                    [user]="user"
                    [amount]="amountToPay"
                    (paymentSuccess)="onPaymentSuccess($event)"
                    (paymentFailure)="onPaymentFailure($event)"
                    ></app-credit-card-form>
                                    
                </div>
            </mat-card>

            <mat-card>
                <mat-card-header>
                    <mat-card-title>Mode de récupération</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <mat-form-field>
                        <mat-label>Choisir le mode de récupération</mat-label>
                        <mat-select formControlName="pickupMethod">
                            <mat-option value="pickup">Ramassage en magasin</mat-option>
                            <mat-option value="delivery">Livraison à domicile</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div *ngIf="checkoutForm.get('pickupMethod')?.value === 'delivery'">
                        <mat-form-field>
                            <mat-label>Adresse</mat-label>
                            <input matInput formControlName="address">
                        </mat-form-field>
                        <mat-form-field>
                            <mat-label>Ville</mat-label>
                            <input matInput formControlName="city">
                        </mat-form-field>
                        <mat-form-field>
                            <mat-label>Pays</mat-label>
                            <mat-select formControlName="country">
                                <mat-option *ngFor="let country of countries" [value]="country">
                                    {{ country }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field>
                            <mat-label>Code postal</mat-label>
                            <input matInput formControlName="postalCode">
                        </mat-form-field>
                    </div>
                    <div *ngIf="checkoutForm.get('pickupMethod')?.value === 'pickup'">
                        <p class="pickup-address">
                            Vous avez choisi le ramassage en magasin.<br> L'adresse du magasin est : <br><br>
                            tiptech 114 rue paris 93260 les lilas.
                        </p>
                    </div>
                </mat-card-content>
            </mat-card>

            <mat-progress-bar *ngIf="loading" mode="query"></mat-progress-bar>
            <br>

            <button class="confirm-btn" (click)="onSubmit($event)">  {{ checkoutForm.get('paymentMethod')?.value === 'card' ? 'Payez Maintenant' : 'Valider la Commande' }}</button>
           
        </form>
    </div>
</div>
